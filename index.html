<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEIS - Trap Nation Experience</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React y Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Poppins:wght@300;400;600&display=swap');

        body { 
            background-color: #000; 
            margin: 0; 
            overflow: hidden; 
            font-family: 'Poppins', sans-serif;
            color: white;
        }

        h1 { font-family: 'Cinzel', serif; }

        /* Firmamento Estrellado */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.8; }
        }
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            pointer-events: none;
            animation: twinkle var(--d) infinite ease-in-out;
        }

        /* --- EFECTO TRAP NATION --- */
        .card-wrapper {
            position: relative;
            padding: 2px;
            border-radius: 2rem;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 70px rgba(255, 255, 255, 0.08);
            transition: transform 0.05s linear;
        }

        .card-wrapper::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent 20%, #000 40%, #fff 50%, #000 60%, transparent 80%);
            animation: rotateWave 4s linear infinite;
        }

        @keyframes rotateWave { to { transform: rotate(360deg); } }

        .glass-card {
            background: rgba(0, 0, 0, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 1.9rem;
            width: 100%;
            padding: 3rem 2rem;
            text-align: center;
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        /* Aberraciones RGB que reaccionarán al audio */
        .rgb-layer {
            position: absolute;
            inset: 0;
            border-radius: inherit;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.1s, transform 0.1s;
        }

        .rgb-cyan { background: rgba(0, 255, 255, 0.2); filter: blur(15px); }
        .rgb-red { background: rgba(255, 0, 0, 0.2); filter: blur(15px); }

        /* Animaciones de carga */
        .animate-fade-in { animation: fadeIn 2s forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const App = () => {
            const [hasEntered, setHasEntered] = useState(false);
            const [isPlaying, setIsPlaying] = useState(false);
            const [isPlayerExpanded, setIsPlayerExpanded] = useState(false);
            const audioRef = useRef(null);
            const canvasRef = useRef(null);
            const analyzerRef = useRef(null);
            const animationRef = useRef(null);
            const cardRef = useRef(null);
            const [stars, setStars] = useState([]);

            // Generar estrellas una sola vez
            useEffect(() => {
                const newStars = [];
                for(let i=0; i<150; i++) {
                    newStars.push({
                        id: i,
                        x: Math.random() * 100,
                        y: Math.random() * 100,
                        size: Math.random() * 2,
                        duration: 2 + Math.random() * 5
                    });
                }
                setStars(newStars);
            }, []);

            // Configurar el analizador de audio real
            const initAudio = () => {
                if (!audioRef.current || analyzerRef.current) return;
                
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const source = audioContext.createMediaElementSource(audioRef.current);
                    const analyzer = audioContext.createAnalyser();
                    
                    analyzer.fftSize = 256;
                    source.connect(analyzer);
                    analyzer.connect(audioContext.destination);
                    
                    analyzerRef.current = analyzer;
                    drawVisualizer();
                } catch (e) {
                    console.error("Audio Context Init Failed:", e);
                }
            };

            const drawVisualizer = () => {
                if (!analyzerRef.current || !canvasRef.current) return;

                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const bufferLength = analyzerRef.current.frequencyBinCount;
                const dataArray = new Uint8Array(bufferLength);

                const renderFrame = () => {
                    animationRef.current = requestAnimationFrame(renderFrame);
                    analyzerRef.current.getByteFrequencyData(dataArray);

                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    const centerX = canvas.width / 2;
                    const centerY = canvas.height / 2;
                    const radius = 235; 

                    // Lógica de pulso basada en bajos
                    let bass = 0;
                    for(let i=0; i<12; i++) bass += dataArray[i];
                    bass = bass / 12;
                    
                    const scale = 1 + (bass / 400); 
                    if(cardRef.current) {
                        cardRef.current.style.transform = `scale(${scale})`;
                        
                        const rgbLayers = cardRef.current.querySelectorAll('.rgb-layer');
                        if (bass > 160) {
                            const shift = bass / 12;
                            rgbLayers[0].style.opacity = '0.7';
                            rgbLayers[0].style.transform = `translate(-${shift}px, ${shift/2}px)`;
                            rgbLayers[1].style.opacity = '0.7';
                            rgbLayers[1].style.transform = `translate(${shift}px, -${shift/2}px)`;
                        } else {
                            rgbLayers.forEach(l => {
                                l.style.opacity = '0';
                                l.style.transform = 'translate(0, 0)';
                            });
                        }
                    }

                    // Dibujar barras circulares COLORIDAS (Estilo Trap Nation PRO)
                    for (let i = 0; i < bufferLength; i++) {
                        const barHeight = (dataArray[i] / 255) * 180; // Aumentado para ser más evidente
                        const angle = (i / bufferLength) * Math.PI * 2;
                        
                        const xStart = centerX + Math.cos(angle) * radius;
                        const yStart = centerY + Math.sin(angle) * radius;
                        const xEnd = centerX + Math.cos(angle) * (radius + barHeight);
                        const yEnd = centerY + Math.sin(angle) * (radius + barHeight);

                        // Crear color dinámico basado en la frecuencia (Arcoíris neón)
                        const hue = (i / bufferLength) * 360;
                        ctx.beginPath();
                        ctx.strokeStyle = `hsla(${hue}, 80%, 60%, ${dataArray[i]/255 + 0.3})`;
                        ctx.lineWidth = 5; // Más grueso
                        ctx.lineCap = 'round';
                        ctx.moveTo(xStart, yStart);
                        ctx.lineTo(xEnd, yEnd);
                        ctx.stroke();
                        
                        // Añadir un pequeño "glow" a cada barra
                        ctx.beginPath();
                        ctx.strokeStyle = `hsla(${hue}, 80%, 60%, 0.2)`;
                        ctx.lineWidth = 10;
                        ctx.moveTo(xStart, yStart);
                        ctx.lineTo(xEnd, yEnd);
                        ctx.stroke();
                    }
                };

                renderFrame();
            };

            const handleEnter = () => {
                setHasEntered(true);
                setIsPlaying(true);
                
                if (audioRef.current) {
                    audioRef.current.currentTime = 15;
                    audioRef.current.play().then(() => {
                        initAudio();
                    }).catch(err => console.log("Play failed:", err));
                }
            };

            const togglePlay = () => {
                if (isPlaying) {
                    audioRef.current.pause();
                } else {
                    audioRef.current.play();
                }
                setIsPlaying(!isPlaying);
            };

            return (
                <div className="min-h-screen bg-black text-white flex flex-col items-center justify-center relative overflow-hidden select-none">
                    <audio ref={audioRef} src="musica.mp3" loop crossOrigin="anonymous" />

                    {/* Estrellas */}
                    {stars.map(star => (
                        <div key={star.id} className="star" style={{ 
                            left: `${star.x}%`, top: `${star.y}%`, 
                            width: `${star.size}px`, height: `${star.size}px`, 
                            '--d': `${star.duration}s` 
                        }} />
                    ))}

                    {!hasEntered ? (
                        <div className="relative z-20 flex flex-col items-center space-y-12 animate-fade-in px-4 text-center">
                            <h1 className="text-8xl md:text-9xl font-bold tracking-[0.4em] uppercase text-white">DEIS</h1>
                            <button onClick={handleEnter} className="px-16 py-6 border border-white/30 font-light text-[10px] tracking-[0.6em] uppercase hover:border-white hover:bg-white hover:text-black transition-all duration-700 rounded-full">
                                Initialize Bass
                            </button>
                        </div>
                    ) : (
                        <div className="relative z-10 flex flex-col items-center w-full max-w-4xl h-screen justify-center">
                            
                            <canvas 
                                ref={canvasRef} 
                                width={1000} 
                                height={1000} 
                                className="absolute pointer-events-none"
                                style={{ width: '850px', height: '850px' }}
                            />

                            <div ref={cardRef} className="card-wrapper w-full max-w-sm">
                                <div className="rgb-layer rgb-cyan" />
                                <div className="rgb-layer rgb-red" />
                                
                                <div className="glass-card">
                                    <h1 className="text-5xl md:text-6xl font-bold tracking-[0.5em] text-center uppercase text-white">
                                        DEIS
                                    </h1>

                                    <div className="relative w-64 h-64 border-[1px] border-white/10 overflow-hidden bg-zinc-950">
                                        <img 
                                            src="https://xatimg.com/image/fx2VKgs21uNd.jpg" 
                                            alt="Deis" 
                                            className="w-full h-full object-cover grayscale-[10%]" 
                                        />
                                    </div>

                                    <div className="text-center space-y-1">
                                        <p className="text-[7px] tracking-[0.4em] text-white/20 font-bold uppercase">Audio Reactive System</p>
                                        <p className="text-[9px] font-bold tracking-[0.15em] uppercase">6ix9ine, Nicki Minaj - FEFE</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Mini Player */}
                    {hasEntered && (
                        <div className={`fixed bottom-10 left-10 z-50 transition-all duration-1000 ${isPlayerExpanded ? 'w-80' : 'w-16'}`}>
                            <div className="bg-white/[0.03] backdrop-blur-3xl border border-white/10 rounded-full overflow-hidden shadow-2xl">
                                <div className="flex items-center p-5 cursor-pointer justify-between" onClick={() => setIsPlayerExpanded(!isPlayerExpanded)}>
                                    <div className="flex items-center gap-5">
                                        <div className={`p-1.5 border border-white/10 rounded-full ${isPlaying ? 'animate-spin-slow' : ''}`}>
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className="w-4 h-4"><path d="M9 18V5l12-2v13" /><circle cx="6" cy="18" r="3" /><circle cx="18" cy="16" r="3" /></svg>
                                        </div>
                                        {isPlayerExpanded && (
                                            <div className="flex flex-col animate-fade-in text-white overflow-hidden">
                                                <span className="text-[7px] uppercase tracking-[0.4em] text-white/40 font-bold mb-1">Frequency Active</span>
                                                <span className="text-[9px] font-bold tracking-[0.1em] truncate max-w-[180px]">FEFE ft. Murda Beatz</span>
                                            </div>
                                        )}
                                    </div>
                                </div>
                                {isPlayerExpanded && (
                                    <div className="px-6 pb-8 flex items-center justify-center animate-fade-in">
                                        <button onClick={(e) => { e.stopPropagation(); togglePlay(); }} className="w-14 h-14 border border-white/5 rounded-full flex items-center justify-center hover:bg-white hover:text-black transition-all">
                                            {isPlaying ? (
                                                <svg viewBox="0 0 24 24" fill="currentColor" className="w-5 h-5"><rect x="6" y="4" width="4" height="16" /><rect x="14" y="4" width="4" height="16" /></svg>
                                            ) : (
                                                <svg viewBox="0 0 24 24" fill="currentColor" className="w-5 h-5 ml-1"><polygon points="5 3 19 12 5 21 5 3" /></svg>
                                            )}
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
